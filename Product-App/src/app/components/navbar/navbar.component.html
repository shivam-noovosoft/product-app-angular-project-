<nav>
  <div class="username-input-div">

    <span *ngIf="!router.url.includes('/cart/')">
      {{ loggedUserData.firstName }} {{ loggedUserData.lastName }}
    </span>

    <span *ngIf="router.url.includes('/cart/')">
      {{ currentUserData.firstName }} {{ currentUserData.lastName }}
     </span>

    <ng-container *ngIf="!router.url.includes('/cart/')">

      <ng-select class="user-select"
                 clearable="false"
                 #selectedUser='ngModel' [(ngModel)]="selectUser"
                 (ngModelChange)="adminSelectedUser(selectedUser.value)"
                 *ngIf="loggedUserData.role === 'admin'"
                 placeholder="Select user">

        @for (user of users; track user.id) {
          <ng-option [value]="user">
            {{ user.firstName }} {{ user.lastName }}
          </ng-option>
        }

      </ng-select>

    </ng-container>

    <input type="text" placeholder="Search products...."
           [formControl]="searchValue"
           *ngIf="!router.url.includes('/cart/')"
    />


  </div>

  <div class="navDiv-1" *ngIf="!router.url.includes('/cart/')">

    <div class="categoryDiv">

      <ng-select
        placeholder="Show all"
        #category='ngModel' [(ngModel)]="selectedCategory"
        class="select-category"
        (clear)="resetCategorySelect()"
        (ngModelChange)="getProductByCategory(category.value)">

        @for (category of categories; track category.slug) {
          <ng-option [value]="category.slug">{{ category.name }}</ng-option>
        }

      </ng-select>

    </div>

    <button id="cartBtn" (click)="getUserCartItems()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="25">
        <path
          d="M8,3V7H21L18,17H6V4H4A1,1,0,0,1,4,2H7A1,1,0,0,1,8,3ZM6,20.5A1.5,1.5,0,1,0,7.5,19,1.5,1.5,0,0,0,6,20.5Zm9,0A1.5,1.5,0,1,0,16.5,19,1.5,1.5,0,0,0,15,20.5Z"/>
      </svg>
      Cart
      <sup>{{ cartItems?.totalQuantity }}</sup>
    </button>
    <button *ngIf="currentUserData.role==='admin'" type="button" (click)="openNewProductModal(form)">Add
      product
    </button>
    <button (click)="logout()">Logout</button>

  </div>


  <ng-container *ngIf="router.url.includes('/cart/')">
    <button (click)="backToProductPage()" class="backBtn">Back</button>
  </ng-container>

  <ng-template #form>
    <div class="modal-dialog modal-dialog-centered m-0 smaller" >
      <div class="modal-content " >
        <div class="modal-header">
          <h5>Please provide product details</h5>
        </div>
        <div class="modal-body">
          <form [formGroup]="newProductForm" class="product-form" (ngSubmit)="addNewProduct()">
            <div>
              <label for="title">Title:</label>
              <input id="title" type="text" formControlName="title"/><br>
              <span style="color: #e30e09"
                    *ngIf="newProductForm.get('title')?.invalid && newProductForm.get('title')?.touched">title is required</span>
            </div>
            <div>
              <label for="price">Price: </label>
              <input id="price" type="number" formControlName="price"/><br>
              <span style="color: #e30e09"
                    *ngIf="newProductForm.get('price')?.invalid && newProductForm.get('price')?.touched">price is required and should be greater than 0</span>
            </div>
            <div>
              <label for="rating">Rating: </label>
              <input id="rating" type="number" formControlName="rating"/><br>
              <span style="color: #e30e09"
                    *ngIf="newProductForm.get('rating')?.invalid && newProductForm.get('rating')?.touched">rating is required and should be less than 5</span>
            </div>
            <label for="description">Description: </label>
            <input id="description" type="text" formControlName="description"/>
            <span
              style="color: #e30e09"
              *ngIf="newProductForm.get('description')?.invalid && newProductForm.get('description')?.touched">description  is required</span>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary"
                      [disabled]="!newProductForm.valid"
              >Add
              </button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="closeModel(form)">Close
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </ng-template>

</nav>

